# Crovia Artifact Contract (CRC-1)

**Goal:** define a *minimal, deterministic, offline-verifiable* output contract for Crovia Open Core.

This spec is intentionally simple:
- it enables a **single command** UX (`crovia-run`)
- without breaking the **offline-verifiable primitives**
- and without forcing users to learn internal file layout

Crovia must remain:
- reproducible
- audit-friendly
- result-first (start from outputs)
- neutral (no legal judgments, no intent attribution)

---

## 0) Definitions

- **Receipts (NDJSON):** declared inputs or derived declarations (e.g., `royalty_receipt.v1` records).
- **Report (MD):** human-readable validation output that matches deterministic checks.
- **Proof (TXT/NDJSON):** integrity anchors (hashchain).
- **Bundle (JSON):** the main *evidence object* that references other artifacts by hash.
- **Manifest (JSON):** index that lists every artifact in the output folder with SHA256.

---

## 1) Output Folder Contract

A Crovia run produces a single output directory:

`./out/` (name chosen by the operator)

The directory MUST contain the following **CRC-1 REQUIRED** files:

1. `receipts.ndjson`
2. `validate_report.md`
3. `hashchain.txt`
4. `trust_bundle.json`
5. `MANIFEST.json`

Optional files (CRC-1 OPTIONAL):
- `trust_bundle.sig` (demo HMAC signature)
- `trust_bundle.sha256` (single-file hash anchor)

---

## 2) File Semantics

### 2.1 receipts.ndjson (REQUIRED)

- Must be byte-stable once generated.
- Must be the *single source of truth* for the runâ€™s declared inputs.

Minimal expectations:
- each line is a JSON object
- no trailing commas
- UTF-8 encoding

---

### 2.2 validate_report.md (REQUIRED)

- Must be generated by Open Core validation rules.
- Must include a deterministic **Health** grade (e.g., `Health=A`) and counts:
  - total
  - valid
  - errors
  - warnings

---

### 2.3 hashchain.txt (REQUIRED)

- Integrity proof over `receipts.ndjson`.
- Must fail verification if **any byte** of receipts changes.

---

### 2.4 trust_bundle.json (REQUIRED)

- The primary artifact an auditor reads first.
- Must include:
  - schema/version identifier
  - references to receipts + hashchain (by SHA256 or path + SHA256)
  - minimal metadata: period (if provided), created_at

---

### 2.5 MANIFEST.json (REQUIRED)

- Machine-readable index of outputs.
- Must include SHA256 for every file in the output folder.
- Must include file sizes and relative paths.

Example structure (non-binding):

{
  "schema": "crovia_manifest.v1",
  "created_at": "2026-01-05T10:00:00Z",
  "root": "out_demo",
  "files": [
    { "path": "receipts.ndjson", "sha256": "...", "bytes": 1234 },
    { "path": "validate_report.md", "sha256": "...", "bytes": 2345 }
  ]
}

---

## 3) Determinism Rules (NON-NEGOTIABLE)

A CRC-1 run MUST be deterministic given the same inputs and tool versions:

- No network calls required
- No random seeds unless explicitly fixed and recorded
- Stable ordering when serializing JSON (sorted keys if applicable)
- Stable numeric formatting (avoid locale issues)

---

## 4) Offline Verification (Result-first)

A third party must be able to verify without Crovia installed, using only standard tools:

### Verify file hashes
- Compute SHA256 for each file
- Compare against `MANIFEST.json`

### Verify hashchain
- Run Open Core verifier OR any independent verifier implementing the same rolling hash rules

### Inspect bundle
- Ensure it references receipts and proofs by hash

---

## 5) What CRC-1 Does NOT Claim

CRC-1 outputs:

- do NOT confirm training
- do NOT accuse any actor
- do NOT map automatically to legal compliance

CRC-1 **is evidence of**:
- declared inputs
- deterministic checks
- tamper-evident integrity
- reproducible packaging

---

## 6) Relationship to CLI / Orchestrators

Open Core primitives remain usable independently:

- validate
- trace
- bundle
- sign
- explain

`crovia-run` is a **reference orchestrator** that simply produces CRC-1 outputs.

No tool may require `crovia-run` to exist.

